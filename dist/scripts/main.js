"use strict";function _classCallCheck(e,n){if(!(e instanceof n))throw new TypeError("Cannot call a class as a function")}var _typeof="function"==typeof Symbol&&"symbol"==typeof Symbol.iterator?function(e){return typeof e}:function(e){return e&&"function"==typeof Symbol&&e.constructor===Symbol&&e!==Symbol.prototype?"symbol":typeof e},_createClass=function(){function e(e,n){for(var t=0;t<n.length;t++){var r=n[t];r.enumerable=r.enumerable||!1,r.configurable=!0,"value"in r&&(r.writable=!0),Object.defineProperty(e,r.key,r)}}return function(n,t,r){return t&&e(n.prototype,t),r&&e(n,r),n}}();!function(){function e(e,n,t){e[n]=e.hasOwnProperty(n)?e[n]:t}function n(e,n,t){return e/n*2*s+(t+p)*a}function t(e,n){e.offsetX=e.width/2,e.offsetY=e.height/2,n.call(e)}function r(e,n){var r=new Image;if(r.src=e,r.complete)return void t(r,n);r.onload=function(){t(r,n)}}function i(){f.clearRect(0,0,y,h),f.fillRect(0,0,y,h),f.globalCompositeOperation="lighter",r("./images/sprBullet.png",function(){var e=this,n=new v;z.forEach(function(t){switch(t.type){case"line":n.createLine(e,t);break;case"circle":n.createCircle(e,t);break;case"polygon":n.createPolygon(e,t);break;case"star":n.createStar(e,t);break;case"parallelepiped":n.createParallelepiped(e,t)}})}),window.requestAnimFrame(i)}var s=Math.PI,a=s/180,o=Math.cos,c=Math.sin,l=Math.sqrt,u=Math.abs,y=1200,h=800,p=-90,d=function(){function e(){var n=arguments.length>0&&void 0!==arguments[0]?arguments[0]:0,t=arguments.length>1&&void 0!==arguments[1]?arguments[1]:0,r=arguments.length>2&&void 0!==arguments[2]?arguments[2]:0;_classCallCheck(this,e),this.x=n,this.y=t,this.z=r,this.magnitude=l(this.x*this.x+this.y*this.y+this.z*this.z)}return _createClass(e,[{key:"isZeroVector",value:function(){return 0===this.x&&0===this.y&&0===this.z}},{key:"normalize",value:function(){if(!1===this.isZeroVector()){var e=this.magnitude;this.x/=e,this.y/=e,this.z/=e,this.magnitude=1}return this}},{key:"multiplyByNumber",value:function(e){this.x*=e,this.y*=e,this.z*=e,this.magnitude*=e}},{key:"cross",value:function(n){return new e(this.y*n.z-this.z*n.y,this.z*n.x-this.x*n.z,this.x*n.y-this.y*n.x)}},{key:"rotate",value:function(n,t){if(!(n instanceof e))throw new TypeError("Cannot rotate the "+(void 0===n?"undefined":_typeof(n)));n.normalize();var r=n.x,i=n.y,s=n.z,l=new e;if(this.isZeroVector())throw new RangeError("Cannot rotate zero vector");var u=o(t*a),y=c(t*a),h=[[u+r*r*(1-u),r*i*(1-u)-s*y,r*s*(1-u)+i*y],[i*r*(1-u)+s*y,u+i*i*(1-u),i*s*(1-u)-r*y],[s*r*(1-u)-i*y,s*i*(1-u)+r*y,u+s*s*(1-u)]];return l.x=this.x*h[0][0]+this.y*h[1][0]+this.z*h[2][0],l.y=this.x*h[0][1]+this.y*h[1][1]+this.z*h[2][1],l.z=this.x*h[0][2]+this.y*h[1][2]+this.z*h[2][2],l}},{key:"getUnitVectors",value:function(){var n=[];return n[0]=this.cross(new e(1,0,0)),!0===n[0].isZeroVector()&&(n[0]=this.cross(new e(0,1,0))),n[1]=this.cross(n[0]).normalize(),n[0].normalize(),n}},{key:"toString",value:function(){return"("+this.x+", "+this.y+", "+this.z+")"}},{key:"valueOf",value:function(){return this.magnitude}}]),e}(),w=function(){function e(){var n=arguments.length>0&&void 0!==arguments[0]?arguments[0]:0,t=arguments.length>1&&void 0!==arguments[1]?arguments[1]:0,r=arguments.length>2&&void 0!==arguments[2]?arguments[2]:0;_classCallCheck(this,e),this.x=n,this.y=t,this.z=r}return _createClass(e,[{key:"translateByXYZ",value:function(){var e=arguments.length>0&&void 0!==arguments[0]?arguments[0]:0,n=arguments.length>1&&void 0!==arguments[1]?arguments[1]:0,t=arguments.length>2&&void 0!==arguments[2]?arguments[2]:0;this.x+=e,this.y+=n,this.z+=t}},{key:"translateByVector",value:function(n){var t=new e;return t.x=this.x+n.x,t.y=this.y+n.y,t.z=this.z+n.z,t}},{key:"translateByUnitVectors",value:function(n,t,r){var i=new e,s=o(r),a=c(r);return i.x=this.x-t*(n[0].x*s+n[1].x*a),i.y=this.y-t*(n[0].y*s+n[1].y*a),i.z=this.z+t*(n[0].z*s+n[1].z*a),i}},{key:"nthDivDot",value:function(n,t,r){var i=new e;return i.x=this.x+(n.x-this.x)/r*t,i.y=this.y+(n.y-this.y)/r*t,i.z=this.z+(n.z-this.z)/r*t,i}}]),e}(),m=document.getElementById("canvas");m.width=y,m.height=h;var f=m.getContext("2d"),v=function(){function t(){_classCallCheck(this,t)}return _createClass(t,[{key:"createDot",value:function(e,n){var t=arguments.length>2&&void 0!==arguments[2]?arguments[2]:1;f.drawImage(e,n.x-e.offsetX,n.y-e.offsetY,1*e.width*t,1*e.height*t)}},{key:"createLine",value:function(e,n){this.setDefaultParameter(n);for(var t=new w,r=0;r<n.number;r++)t=n.startPos.nthDivDot(n.endPos,r,n.number-n.includeEnd),this.createDot(e,t,n.scale);this.spin(n,n.spin)}},{key:"createCircle",value:function(e,t){this.setDefaultParameter(t);for(var r=t.normalVector.getUnitVectors(),i=0;i<t.number;i++){var s=n(i,t.number,t.angle),a=t.centerPos.translateByUnitVectors(r,t.radius,s);this.createDot(e,a,t.scale)}this.spin(t,t.spin)}},{key:"createPolygon",value:function(e,t){this.setDefaultParameter(t);var r=void 0;if("number"==typeof t.numPerSide)r=t.numPerSide-1;else{if(!(t.numPerSide instanceof Array))throw Error("The value of numPerSide is "+t.numPerSide);if(t.numPerSide.length!==t.side)throw Error("Length of numPerSide should be exact same with side number");r=t.numPerSide.map(function(e){return e-1})}for(var i=[],s={scale:t.scale,includeEnd:!1},a=t.normalVector.getUnitVectors(),o=0;o<t.side;o++){var c=n(o,t.side,t.angle),l=t.centerPos.translateByUnitVectors(a,t.radius,c);i.push(l)}for(var u=0;u<t.side;u++)s.number="number"==typeof r?r:r[u],s.startPos=i[u],s.endPos=i[(u+1+t.isStar)%t.side],this.createLine(e,s);this.spin(t,t.spin)}},{key:"createStar",value:function(t,r){if(this.setDefaultParameter(r),r.fillInner)r.isStar=!0,this.createPolygon(t,r);else{e(r,"concave",.5);for(var i=[],c=[],l=r.radius*o(s/r.side)*r.concave,u={number:r.numPerSide-1,scale:r.scale,includeEnd:!1},y=r.normalVector.getUnitVectors(),h=0;h<r.side;h++){var p=n(h,r.side,r.angle),d=r.centerPos.translateByUnitVectors(y,r.radius,p),w=p+(180/r.side+360*r.skew)*a,m=r.centerPos.translateByUnitVectors(y,l,w);i.push(d),c.push(m)}for(var f=0;f<r.side;f++)u.startPos=i[f],u.endPos=c[f],this.createLine(t,u),u.startPos=c[f],u.endPos=i[(f+1)%r.side],this.createLine(t,u);this.spin(r,r.spin)}}},{key:"createParallelepiped",value:function(e,n){this.setDefaultParameter(n);for(var t=[[1,1,1],[-1,1,1],[-1,-1,1],[1,-1,1],[1,1,-1],[-1,1,-1],[-1,-1,-1],[1,-1,-1]],r=[],i=[],s=n.number instanceof Array?n.number:[n.number,n.number,n.number],a=n.vectors,o=0;o<12;o++)i.push({type:"line",scale:n.scale});for(var c=0;c<8;c++)r[c]=new d,r[c].x=a[0].x*t[c][0]+a[1].x*t[c][1]+a[2].x*t[c][2],r[c].y=a[0].y*t[c][0]+a[1].y*t[c][1]+a[2].y*t[c][2],r[c].z=a[0].z*t[c][0]+a[1].z*t[c][1]+a[2].z*t[c][2];for(var l=0;l<4;l++){for(var u=0;u<2;u+=1)i[l+4*u].startPos=n.centerPos.translateByVector(r[l+4*u]),i[l+4*u].endPos=n.centerPos.translateByVector(r[(l+1)%4+4*u]),i[l+4*u].number=l%2==0?s[0]-1:s[1]-1,this.createLine(e,i[l+4*u]);i[l+8].startPos=n.centerPos.translateByVector(r[l]),i[l+8].endPos=n.centerPos.translateByVector(r[l+4]),i[l+8].number=s[2]-1,this.createLine(e,i[l+8])}this.spin(n,n.spin)}},{key:"spin",value:function(e,n){var t=function(e,n){return e.rotate(new d(n.x,0,0),u(n.x)).rotate(new d(0,n.y,0),u(n.y)).rotate(new d(0,0,n.z),u(n.z))};arguments[1]instanceof d?e.hasOwnProperty("vectors")?e.vectors=e.vectors.map(function(e){return t(e,n)}):(e.normalVector=t(e.normalVector,n),e.angle=(e.angle+n.z)%360):e.angle=(e.angle+n)%360}},{key:"setDefaultParameter",value:function(n){switch(e(n,"scale",1),e(n,"spin",0),e(n,"normalVector",new d(0,0,1)),n.type){case"line":e(n,"includeEnd",!1);break;case"circle":e(n,"angle",0);break;case"polygon":e(n,"angle",0),e(n,"isStar",0);break;case"star":e(n,"angle",0),e(n,"fillInner",!1),e(n,"concave",.5),e(n,"skew",0)}}}]),t}(),P={circle:[{type:"circle",centerPos:new w(200,200),number:20,radius:100,angle:0,spin:new d(0,0,1)},{type:"circle",centerPos:new w(600,200),number:24,radius:120,angle:0,spin:new d(2,0,0)},{type:"circle",centerPos:new w(1e3,200),number:20,radius:100,angle:0,spin:new d(0,1.5,0)},{type:"circle",centerPos:new w(200,600),number:20,radius:100,angle:0,normalVector:new d(0,1,.2),spin:new d(0,2,.4)},{type:"circle",centerPos:new w(200,600),number:20,radius:100,angle:0,normalVector:new d(1,0,.2),spin:new d(2,0,.4)},{type:"circle",centerPos:new w(600,600),number:20,radius:100,angle:0,scale:2,spin:new d(0,.7,1)},{type:"circle",centerPos:new w(1e3,600),number:40,radius:100,angle:0,scale:.5,normalVector:new d(-.5,1,.2),spin:new d(-1,2,1.4)},{type:"circle",centerPos:new w(1e3,600),number:40,radius:100,angle:0,scale:.5,normalVector:new d(1,.5,.2),spin:new d(2,1,1.4)}],polygon:[{type:"polygon",centerPos:new w(200,200),side:4,numPerSide:8,radius:100,angle:0,spin:new d(0,0,1)},{type:"polygon",centerPos:new w(600,200),side:5,numPerSide:8,radius:100,angle:0,spin:new d(0,0,-1)},{type:"polygon",centerPos:new w(1e3,200),side:3,numPerSide:[5,10,10],radius:100,angle:30,spin:new d(0,0,1)},{type:"polygon",centerPos:new w(200,600),side:5,numPerSide:3,radius:100,angle:0,scale:1.5,spin:new d(2,0,0)},{type:"polygon",centerPos:new w(600,600),side:6,numPerSide:15,radius:200/l(3),angle:30,scale:.5,spin:new d(1,0,1)},{type:"polygon",centerPos:new w(600,600),side:6,numPerSide:15,radius:100,angle:0,scale:.5,spin:new d(1,0,1)},{type:"polygon",centerPos:new w(600,600),side:6,numPerSide:15,radius:50*l(3),angle:30,scale:.5,spin:new d(1,0,1)},{type:"polygon",centerPos:new w(1e3,600),side:12,numPerSide:16,scale:.3,radius:160,angle:0,spin:new d(0,0,1)}],star:[{type:"star",centerPos:new w(200,200),side:6,numPerSide:16,radius:100,angle:30,fillInner:!0,spin:new d(0,2,0)},{type:"star",centerPos:new w(600,200),side:5,numPerSide:5,concave:.8,radius:100,angle:0,spin:new d(0,0,2)},{type:"star",centerPos:new w(1e3,200),side:5,numPerSide:5,concave:.3,radius:100,angle:0,spin:new d(0,0,2)},{type:"star",centerPos:new w(200,600),side:5,numPerSide:5,skew:1.1,radius:100,angle:0,spin:new d(0,0,2)},{type:"star",centerPos:new w(600,600),side:6,concave:.707,numPerSide:6,radius:100,angle:0,scale:.5,spin:new d(0,0,2)},{type:"star",centerPos:new w(1e3,600),side:4,numPerSide:5,radius:100,angle:0,spin:new d(2,0,2)}],parallelepiped:[{type:"parallelepiped",centerPos:new w(200,200,0),number:[10,10,10],vectors:[new d(70,0,0),new d(0,70,0),new d(0,0,70)],spin:new d(1,1,1)},{type:"parallelepiped",centerPos:new w(600,200,0),number:[10,10,10],vectors:[new d(50,0,0),new d(0,100,0),new d(0,0,100)],spin:new d(1,1,1)},{type:"parallelepiped",centerPos:new w(1e3,200,0),number:[10,10,10],vectors:[new d(40,30,0),new d(-30,70,0),new d(0,0,70)],spin:new d(1,1,1)},{type:"parallelepiped",centerPos:new w(200,600,0),number:[10,16,10],vectors:[new d(50,0,0),new d(0,80,0),new d(0,0,50)],spin:new d(1,1,1)},{type:"parallelepiped",centerPos:new w(600,600,0),number:[10,20,24],scale:.5,vectors:[new d(30,40,0),new d(-60,80,0),new d(0,0,120)],spin:new d(1,1,1)},{type:"parallelepiped",centerPos:new w(1e3,600,0),number:[10,10,10],vectors:[new d(70,0,0),new d(0,70,0),new d(0,0,70)],spin:new d(-1,-1,-1)}]};window.requestAnimFrame=function(){return window.requestAnimationFrame||window.webkitRequestAnimationFrame||window.mozRequestAnimationFrame||window.oRequestAnimationFrame||window.msRequestAnimationFrame||function(e){window.setTimeout(e,1e3/60)}}();var g=Object.keys(P),b=0,z=P[g[b]];m.addEventListener("click",function(){b=(b+1)%g.length,z=P[g[b]]}),i()}();